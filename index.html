<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Sentiment & Noun Analyzer</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 10px; }
        input, button { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; cursor: pointer; }
        button:hover { background: #0056b3; }
        .review-box { background: white; padding: 15px; border: 1px solid #ddd; margin: 10px 0; }
        .result { margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 5px; }
        .noun-highlight { background-color: yellow; font-weight: bold; }
    </style>
    <!-- Подключаем библиотеку для NLP -->
    <script src="https://unpkg.com/compromise@14.0.0/builds/compromise.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Review Sentiment & Noun Analyzer</h1>
        
        <!-- Hugging Face API Setup -->
        <div class="api-setup">
            <h3>Hugging Face API Setup</h3>
            <input type="password" id="apiToken" placeholder="Enter your Hugging Face API Token" style="width: 300px;">
            <p><small>Your token is stored only in your browser and is never sent to our servers.</small></p>
        </div>

        <!-- Analysis Controls -->
        <div class="controls">
            <button onclick="loadRandomReview()">Load Random Review</button>
            <button onclick="analyzeSentiment()">Analyze Sentiment</button>
            <button onclick="countNouns()">Count Nouns</button>
        </div>

        <!-- Display Areas -->
        <div class="review-box">
            <h3>Selected Review:</h3>
            <div id="reviewText">Click "Load Random Review" to load a review.</div>
        </div>

        <div class="result">
            <h3>Analysis Results:</h3>
            <div id="sentimentResult">Sentiment will appear here</div>
            <div id="nounResult">Noun analysis will appear here</div>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <h3>How to get a Hugging Face API Token:</h3>
            <ol>
                <li>Go to huggingface.co and create a free account</li>
                <li>Navigate to your profile settings and access tokens section</li>
                <li>Generate a new token with read permissions</li>
                <li>Copy the token and paste it in the field above</li>
            </ol>
        </div>
    </div>

    <script>
        let currentReview = '';
        let reviews = [];

        // Загружаем тестовые отзывы
        async function loadReviews() {
            // Пример отзывов - в реальном приложении загружай из TSV файла
            reviews = [
                "McVitie's digestive biscuits are great - not nearly as sweet as competitors. Biggest problem is how many are broken by the time they get to you.",
                "I love lemon grass tea! I love this soup! Going to double my order on the next one I make, this one is so good.",
                "The product quality is excellent but the delivery service was terrible. The package arrived damaged and items were missing.",
                "This is the best purchase I've made all year. The quality exceeds expectations and customer service was outstanding.",
                "Disappointed with the product. It broke after first use and customer support was unhelpful."
            ];
        }

        // Загружаем случайный отзыв
        function loadRandomReview() {
            if (reviews.length === 0) loadReviews();
            const randomIndex = Math.floor(Math.random() * reviews.length);
            currentReview = reviews[randomIndex];
            document.getElementById('reviewText').textContent = currentReview;
            document.getElementById('sentimentResult').textContent = 'Sentiment will appear here';
            document.getElementById('nounResult').textContent = 'Noun analysis will appear here';
        }

        // Анализ тональности
        async function analyzeSentiment() {
            const apiToken = document.getElementById('apiToken').value;
            if (!apiToken) {
                alert('Please enter your Hugging Face API Token');
                return;
            }

            if (!currentReview) {
                alert('Please load a review first');
                return;
            }

            try {
                const response = await fetch(
                    "https://api-inference.huggingface.co/models/cardiffnlp/twitter-roberta-base-sentiment",
                    {
                        headers: { Authorization: `Bearer ${apiToken}` },
                        method: "POST",
                        body: JSON.stringify({ inputs: currentReview }),
                    }
                );
                
                const result = await response.json();
                
                if (result.error) {
                    document.getElementById('sentimentResult').textContent = `Error: ${result.error}`;
                    return;
                }

                // Обрабатываем результат
                const sentiment = result[0];
                const topSentiment = sentiment.reduce((prev, current) => 
                    (prev.score > current.score) ? prev : current
                );
                
                document.getElementById('sentimentResult').innerHTML = 
                    `<strong>Sentiment:</strong> ${topSentiment.label} <br>
                     <strong>Confidence:</strong> ${(topSentiment.score * 100).toFixed(2)}%`;

            } catch (error) {
                document.getElementById('sentimentResult').textContent = `API Error: ${error.message}`;
            }
        }

        // Подсчет существительных
        function countNouns() {
            if (!currentReview) {
                alert('Please load a review first');
                return;
            }

            // Используем Compromise.js для NLP
            const doc = window.nlp(currentReview);
            const nouns = doc.nouns().out('array');
            
            // Подсвечиваем существительные в тексте
            let highlightedText = currentReview;
            nouns.forEach(noun => {
                highlightedText = highlightedText.replace(
                    new RegExp(noun.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi'),
                    `<span class="noun-highlight">${noun}</span>`
                );
            });

            document.getElementById('reviewText').innerHTML = highlightedText;
            document.getElementById('nounResult').innerHTML = 
                `<strong>Nouns Found:</strong> ${nouns.length} <br>
                 <strong>List:</strong> ${nouns.join(', ')} <br>
                 <small>Nouns are highlighted in yellow above</small>`;
        }

        // Инициализация
        window.onload = loadReviews;
    </script>
</body>
</html>
