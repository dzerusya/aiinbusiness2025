<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Sentiment & Noun Analyzer</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 10px; }
        input, button { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; cursor: pointer; }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .review-box { background: white; padding: 15px; border: 1px solid #ddd; margin: 10px 0; }
        .result { margin: 10px 0; padding: 10px; background: #e9ecef; border-radius: 5px; }
        .noun-highlight { background-color: yellow; font-weight: bold; }
        .status { color: #666; font-style: italic; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Review Sentiment & Noun Analyzer</h1>
        
        <!-- Hugging Face API Setup -->
        <div class="api-setup">
            <h3>Hugging Face API Setup</h3>
            <input type="password" id="apiToken" placeholder="Enter your Hugging Face API Token" style="width: 300px;" 
                   value="ht_DCEffkDddrgfZWJGPxPJwNhigkuBafHE">
            <p><small>Your token is stored only in your browser and is never sent to our servers.</small></p>
        </div>

        <!-- Analysis Controls -->
        <div class="controls">
            <button onclick="loadRandomReview()">Load Random Review</button>
            <button onclick="analyzeSentiment()">Analyze Sentiment</button>
            <button onclick="countNouns()">Count Nouns</button>
        </div>

        <!-- Display Areas -->
        <div class="review-box">
            <h3>Selected Review:</h3>
            <div id="reviewText">Click "Load Random Review" to load a review.</div>
        </div>

        <div class="result">
            <h3>Analysis Results:</h3>
            <div id="sentimentResult">Sentiment will appear here</div>
            <div id="nounResult">Noun analysis will appear here</div>
        </div>

        <!-- Status -->
        <div class="status" id="status">Ready to load reviews</div>

        <!-- Instructions -->
        <div class="instructions">
            <h3>How to get a Hugging Face API Token:</h3>
            <ol>
                <li>Go to huggingface.co and create a free account</li>
                <li>Navigate to your profile settings and access tokens section</li>
                <li>Generate a new token with read permissions</li>
                <li>Copy the token and paste it in the field above</li>
            </ol>
        </div>
    </div>

    <script>
        let currentReview = '';
        let reviews = [];
        let nlpLibraryLoaded = false;

        // Простые тестовые отзывы (без загрузки TSV для упрощения)
        const testReviews = [
            "The product quality is excellent but the delivery service was terrible.",
            "I love lemon grass tea! I love this soup! Going to double my order.",
            "McVitie's digestive biscuits are great - not nearly as sweet as competitors.",
            "This is the best purchase I've made all year. Outstanding quality!",
            "Disappointed with the product. It broke after first use."
        ];

        // Загружаем случайный отзыв
        function loadRandomReview() {
            const randomIndex = Math.floor(Math.random() * testReviews.length);
            currentReview = testReviews[randomIndex];
            document.getElementById('reviewText').textContent = currentReview;
            document.getElementById('sentimentResult').textContent = 'Sentiment will appear here';
            document.getElementById('nounResult').textContent = 'Noun analysis will appear here';
            document.getElementById('status').textContent = `Loaded review ${randomIndex + 1} of ${testReviews.length}`;
            document.getElementById('status').className = 'status success';
        }

        // Анализ тональности - УПРОЩЕННАЯ ИСПРАВЛЕННАЯ ВЕРСИЯ
        async function analyzeSentiment() {
            const apiToken = document.getElementById('apiToken').value;
            if (!apiToken) {
                alert('Please enter your Hugging Face API Token');
                return;
            }

            if (!currentReview) {
                alert('Please load a review first');
                return;
            }

            const statusEl = document.getElementById('status');
            const resultEl = document.getElementById('sentimentResult');
            
            statusEl.textContent = 'Analyzing sentiment...';
            statusEl.className = 'status';
            resultEl.textContent = 'Processing...';

            try {
                // Используем простую и надежную модель
                const response = await fetch(
                    "https://api-inference.huggingface.co/models/distilbert-base-uncased-finetuned-sst-2-english",
                    {
                        headers: { 
                            Authorization: `Bearer ${apiToken}`,
                            "Content-Type": "application/json"
                        },
                        method: "POST",
                        body: JSON.stringify({ 
                            inputs: currentReview 
                        }),
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('API Response:', result);
                
                if (result.error) {
                    // Если модель загружается, ждем и пробуем снова
                    if (result.error.includes('loading')) {
                        resultEl.textContent = 'Model is loading, please wait 10-20 seconds and try again...';
                        statusEl.textContent = 'Model loading';
                        return;
                    }
                    throw new Error(`Model error: ${result.error}`);
                }

                // Обрабатываем результат для модели sentiment analysis
                if (Array.isArray(result) && result.length > 0) {
                    const sentimentResult = result[0];
                    
                    // Находим наиболее вероятную метку
                    let topLabel = '';
                    let topScore = 0;
                    
                    sentimentResult.forEach(item => {
                        if (item.score > topScore) {
                            topScore = item.score;
                            topLabel = item.label;
                        }
                    });
                    
                    resultEl.innerHTML = 
                        `<strong>Label:</strong> ${topLabel} <br>
                         <strong>Confidence:</strong> ${(topScore * 100).toFixed(2)}% <br>
                         <strong>Model:</strong> distilbert-base-uncased-finetuned-sst-2-english`;
                    
                    statusEl.textContent = 'Sentiment analysis complete';
                    statusEl.className = 'status success';
                } else {
                    throw new Error('Unexpected response format from API');
                }

            } catch (error) {
                console.error('Sentiment analysis error:', error);
                resultEl.innerHTML = `Error: ${error.message}<br>
                                     <small>Try using a different model or check your token</small>`;
                resultEl.className = 'error';
                statusEl.textContent = 'Analysis failed';
                statusEl.className = 'status error';
            }
        }

        // ПРОСТОЙ подсчет существительных (без внешних библиотек)
        function countNouns() {
            if (!currentReview) {
                alert('Please load a review first');
                return;
            }

            const statusEl = document.getElementById('status');
            const resultEl = document.getElementById('nounResult');
            
            statusEl.textContent = 'Counting nouns...';
            statusEl.className = 'status';

            try {
                // Простой алгоритм для поиска существительных
                // В реальном приложении лучше использовать библиотеку, но для демо сойдет
                const words = currentReview.toLowerCase().split(/\s+/);
                
                // Списки распространенных существительных (упрощенно)
                const commonNouns = [
                    'product', 'quality', 'delivery', 'service', 'tea', 'soup', 
                    'order', 'biscuits', 'competitors', 'problem', 'packaging',
                    'purchase', 'year', 'customer', 'support', 'item'
                ];
                
                const foundNouns = words.filter(word => {
                    // Убираем пунктуацию
                    const cleanWord = word.replace(/[^a-z]/g, '');
                    // Проверяем, есть ли слово в списке существительных
                    return commonNouns.includes(cleanWord) && cleanWord.length > 2;
                });
                
                const uniqueNouns = [...new Set(foundNouns)];
                
                // Подсвечиваем найденные существительные
                let highlightedText = currentReview;
                uniqueNouns.forEach(noun => {
                    const regex = new RegExp(`\\b${noun}\\b`, 'gi');
                    highlightedText = highlightedText.replace(regex, `<span class="noun-highlight">${noun}</span>`);
                });

                document.getElementById('reviewText').innerHTML = highlightedText;
                resultEl.innerHTML = 
                    `<strong>Nouns Found:</strong> ${uniqueNouns.length} <br>
                     <strong>Nouns List:</strong> ${uniqueNouns.join(', ')} <br>
                     <small>Note: Using simple noun detection for demo</small>`;
                
                statusEl.textContent = `Found ${uniqueNouns.length} nouns`;
                statusEl.className = 'status success';

            } catch (error) {
                console.error('Noun counting error:', error);
                resultEl.textContent = `Error counting nouns: ${error.message}`;
                resultEl.className = 'error';
                statusEl.textContent = 'Noun counting failed';
                statusEl.className = 'status error';
            }
        }

        // Инициализация
        window.onload = function() {
            reviews = testReviews;
            document.getElementById('status').textContent = 'Ready - loaded test reviews';
        };
    </script>
</body>
</html>
